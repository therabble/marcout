'\nDESCRIPTION--------------------------------------\n\nMARCout is a high-level language for defining MARC bibliographic record\nexports. It\'s currently developed for MUSICat album records.\n\nMARCout describes the necessary prerequisites and desired fields in\na simple declarative form. The hope is that MARCout authoring and editing\nshould be within the grasp of bibliographers who are not programmers.\n\nMARCout PROCESS CHAIN\n\n    {MARCout export definition}\n        |\n         -->[MARCout parser]\n                |\n                 -->{export data structure}\n                            |\n                            |\n    {source record (JSON)}   -->[                       |\n        |                       |MARCout record exporter|                       |\n         ---------------------->|                       ]\n                                    |\n                                     -->{exported record}\n                                            |\n                                             --> [MARCout text serializer]\n                                            or\n                                            |\n                                             --> [MARCout ISO 2709 serializer]\n\n\nEXPRESSIONS\nMARCout defines a simple "expression" syntax for defining exported data. \nExpressions are composed of:\n\n    - MARCout keywords and operators: a limited set of reserved words, single\n        characters, and phrases that provide simple expression semantics.\n\n    - Literal content: fixed strings. Always enclosed in single quotes.\n\n    - Source record extraction expressions: named JSON node syntax expressions\n        found in the JSON EXTRACTED PROPERTIES block of a MARCout file.\n\n    - Function calls: functions whose signatures are listed in the FUNCTIONS \n        block of a MARCout file.\n\n    - Parameters: parameters whose names are listed in the KNOWN PARAMETERS\n        block of a MARCout file\n\nGEEKLY DISCLAIMER:\nProgrammers will be disappointed with MARCout expression semantics & syntax.\nThey will feel immediately frustrated because their normal modes of\nthought and work are ruthlessly unsupported. So, it\'s important to emphasize\nthat MARCout EXPRESSIONS WERE NEVER INTENDED TO BE A SCRIPTING LANGUAGE.\nThey are only a simplistic declarative way to state common-case rules and\ndirectives for composing MARC export content.\n\nThe keywords and operators, in particular, very deliberately leave out some\nthings that programmers would expect. For example:\n\n    - Expression keywords and operators do not support IF/ELSE conditionals.\n\n    - No grouping brackets (except for the parentheses in function calls).\n\n    - There is no proper handling of boolean logic: no `AND`, `OR`,\n        or `NOT` operators; the union of `IS FALSE` and `IS TRUE` does not\n        exhaust the value space of expressions (those keywords are limited\n        to values that *explicitly* indicate true or false conditions).\n\n    - No arithmetic.\n\n    - No date comparisons.\n\n    - And so on.\n\nTake heart, though, programmers: the extensibility loophole is that MARCout\npermits you to define your own functions and add them to your MARCout record\nexporter. NB: don\'t forget to add them to the MARCout export definition \nFUNCTIONS block too.\n\nMARCout EXPRESSION SPECIFIC VALUES:\n\n    - `PRESENT`: (for JSON node expressions and parameters.) A MARCout\n        expression evaluates as `PRESENT` if it does not encounter a\n        "not found" or "undefined" problem.\n\n        Note that an expression will evaluate as `PRESENT` irrespective of\n        its value. A value of None, JSON null, or an empty string, in\n        particular, does not prevent, or in any way affect, evaluation as\n        `PRESENT`.\n\n    - `FALSE`: a MARCOUT expression evaluates as `FALSE` if it is `PRESENT`\n        and has one of the following values: \n\n            - `false` (if boolean),\n\n            - case-insensitive "no" or case-insensitive "false" (if string), \n\n            - 0 (if number)\n\n        Note! the values \'F\' and \'N\' do NOT evaluate as `FALSE`, because \n        they could reasonably signify something else. If you have a "Y/N"\n        or "T/F" enumeration in a field in your JSON, test for the\n        explicit value.\n\n    - `TRUE`: a MARCout expression evaluates as `TRUE` if it is `PRESENT`\n        and has one of the following values: \n\n            - `true` (if boolean),\n\n            - case-insensitive "yes" or case-insensitive "true" (if string), \n\n            - 1 (if number)\n\n        Note! the values \'T\' and \'Y\' do NOT evaluate as `FALSE`, because \n        they could reasonably signify something else. If you have a "Y/N"\n        or "T/F" enumeration in a field in your JSON, test for the\n        explicit value.\n\n    - `EMPTY`: a MARCout expression evaluates as `EMPTY` if it is `PRESENT`\n        and is one of the following:\n\n            - an empty string\n\n            - a whitespace string\n\n            - a collection of type `list`, `tuple`, `dict`, or `set`, with \n                length of zero.\n\n\nMARCout EXPRESSION KEYWORDS AND OPERATORS:\nThis syntax is intended to be simple to learn and not confusing to sight-read.\nIt facilitates composing extracted content from the record to export with\nliteral values and function calls.\n\n    - `IS`: infix operator that compares two sub-expressions for equality. \n        Equivalent to `==` in Python.\n\n    - `IS NOT`: infix operator that compares two sub-expressions for inequality. \n        Equivalent to `!=` in Python.\n\n    - `IS TRUE`: postfix operator that resolves to True if the preceding\n        expression is a MARCout value for `TRUE`.\n\n    - `IS FALSE`: postfix operator that resolves to True if the preceding\n        expression is a MARCout value for `FALSE`.\n\n    - `HAS VALUE`: postfix operator that resolves to True if the preceding \n        expression is PRESENT and not `EMPTY`. In other words, the expression\n        has meaning over and above the ambiguous empty values.\n\n    - `HAS NO VALUE`: postfix operator that resolves to True if the preceding\n        expression is not `PRESENT`, or, if `PRESENT`, is `EMPTY`.\n\n    - `NOTHING`: alias (non-operator) keyword for generation of an empty value.\n        Depending on context, makes an empty string, or a non-value such as \n        Python `None` or JSON `null`.\n\n    - `STARTS WITH`: operator for string values. Resolves to True if the\n        preceding string starts with the subsequent string.\n\n    - `CONTAINS`: operator for string values. Resolves to True if the\n        preceding string starts with the subsequent string.\n\n    - `+`: the concatenation operator for string values. Does NOT represent\n        numeric addition, date addition, etc.\n\n\n\n\n\nKNOWN PARAMETERS---------------------------------\n\n    collection_namespace\n\n    collection_label\n\n    collection_abbr\n\n    collection_host_url\n\n\n\nJSON EXTRACTED PROPERTIES------------------------\n\n    album_id = album_json[\'album\'][\'id\']\n\n    main_artist_name = album_json[\'album\'][\'main_artist_name\']\n\n    artist_is_group = album_json[\'album\'][\'artist_is_group\']\n\n    album_title = album_json[\'album\'][\'title\']\n\n    release_date = normalize_date(album_json[\'album\'][\'release_date\'])\n\n    record_label = album_json[\'album\'][\'record_label\']\n\n    submission_round = album_json[\'album\'][\'round\']\n\n    album_tracks = album_json[\'album\'][\'tracks\']\n\n    spoken_languages = album_json[\'album\'][\'spoken_languages\']\n\n    genre = album_json[\'album\'][\'genre\']\n\n    front_cover_art_link = album_json[\'album\'][\'front_cover_art\']\n\n\n\nFUNCTIONS----------------------------------------\n\n    biblio_name(main_artist_name)\n\n    normalize_date(release_date)\n\n    release_year(release_date)\n\n    release_decade(release_date)\n\n    render_track_duration(track_duration)\n\n    pretty_comma_list(listexpr)\n\n    total_play_length(album_tracks)\n\n    compute_control_number(album_id, collection_abbr)\n\n\n\nMARC FIELD TEMPLATES------------------------------------\n\nFIELD: 001\n    CONTENT: compute_control_number(album_id, collection_abbr)\n\n\nFIELD: 003\n    CONTENT: collection_label + \' MUSICat\'\n\n\n# example of commenting out a block of code\n#FIELD: 003\n#    SUBFIELD: a\n#        collection_label + \' MUSICat\'\n\n\nFIELD: 100\n# note that "EXPORT UNLESS" is a default: if the property is missing or screwed up,\n# that counts as ("artist_is_group": false), so you DO export this field.\nEXPORT UNLESS: artist_is_group IS TRUE     # This is the conjectural "artist_is_group" property\nINDC1: 1\nINDC2: blank\n    SUBFIELD: a                         # subfield code on same line\n        # it\'s OK to have a comment in between -- they get stripped out first\n        biblio_name(main_artist_name)   # subfield value on VERY NEXT non-comment line\n\n\nFIELD: 110\nEXPORT WHEN: artist_is_group IS TRUE\nINDC1: 2\nINDC2: blank\n    SUBFIELD: a\n        main_artist_name + \' (Musical group)\'\n\n\nFIELD: 245\nINDC1: 1\nINDC2: 0\n    SUBFIELD: a\n        album_title\n    SUBFIELD: c\n        main_artist_name\n\n\nFIELD: 260\nINDC1: blank\nINDC2: blank\n    SUBFIELD: a\n        \'[Place of publication not indicated] :\'\n    SUBFIELD: b\n        record_label\n    SUBFIELD: c\n        release_year(release_date)\n\n\nFIELD: 300\nINDC1: blank\nINDC2: blank\n    SUBFIELD: 1\n        \'online resource (1 audio file (\' + total_play_length(album_tracks) + \')) ;\'\n    SUBFIELD: b\n        \'digital\'\n\n\nFIELD: 500\nINDC1: blank\nINDC2: blank\n    SUBFIELD: a\n        \'MUSICat Submission Round: \' + submission_round\n\n\nFIELD: 506\nINDC1: blank\nINDC2: blank\n    SUBFIELD: a\n        \'Streaming available to Library patrons.\'\n    SUBFIELD: m\n        collection_label + \' content provided by MUSICat\'\n\n\nFIELD: 511\nINDC1: blank\nINDC2: blank\n    SUBFIELD: a\n        \'Performed by \' + main_artist_name\n\n\nFIELD: 505\nINDC1: 0\nINDC2: 0\n    FOR EACH: track in album_tracks\n        EACH-SUBFIELD: t\n            track::title\n        EACH-SUBFIELD: g\n            render_duration(track::duration)\n        SORT BY: track::position\n        DEMARC WITH: \' --\'\n\n\nFIELD: 546\nINDC1: blank\nINDC2: blank\n    SUBFIELD: a\n        \'Sung in \' + pretty_comma_list(spoken_languages)\n\n\nFIELD: 650\nINDC1: blank\nINDC2: 0\n    SUBFIELD: a\n        genre\n    SUBFIELD: y\n        release_decade(release_date)\n\n\nFIELD: 710\nINDC1: 2\nINDC2: blank\n    SUBFIELD: a\n        \'Rabble, LLC\'\n    SUBFIELD: u\n        \'MUSICat\'\n\n\n# subfield 42\nFIELD: 856\nINDC1: 4\nINDC2: 2\n    SUBFIELD: z\n        \'Cover image\'\n    SUBFIELD: u\n        front_cover_art_link\n\n\n# subfield 40\nFIELD: 856\nINDC1: 4\nINDC2: 0\n    SUBFIELD: u\n        collection_host_url + \'/albums/\' + album_id\n    SUBFIELD: z\n        \'Click here to access this electronic item\'\n\n'